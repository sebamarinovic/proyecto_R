
---
title: "Análisis Térmico y Gestión de Mantenimiento EP-110"
author: "Sebastián Marinovic"
date: "`r Sys.Date()`"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(hexbin)
```

# 1. Definición del Problema / Objetivo

El monitoreo térmico de los enfriadores EP-110 es esencial para optimizar el control térmico en las plantas de limpieza de gases (GCP-2 y GCP-4). Este análisis utiliza datos de los años 2015 al 2025 para **evaluar el rendimiento térmico, identificar equipos críticos según ΔT Agua, detectar ciclos completos de mantenimiento y analizar la correlación entre la temperatura de gases y ΔT Agua, con el objetivo de predecir la eficiencia y proponer acciones correctivas.**

**Pregunta de investigación:**
> ¿Qué equipos EP-110 presentan bajo desempeño térmico (ΔT Agua < 4°C), cuántos ciclos completos de mantenimiento se han realizado por año, y qué correlación existe entre la temperatura de gases de salida (GCP) y ΔT Agua?


# 2. Introducción

Este análisis investiga el desempeño térmico de los enfriadores EP-110 dentro de las plantas de limpieza de gases GCP-2 y GCP-4, utilizando datos simulados desde 2015 hasta 2025. Comprender el comportamiento térmico de estos enfriadores es crucial para optimizar los procesos de limpieza de gases. El conjunto de datos incluye 1,157,184 registros horarios en `data_extrapolated.csv` y 16,072 registros diarios en `temp_gcp_data_extrapolated.csv`. Estos conjuntos de datos contienen información relevante para las condiciones operativas y la eficiencia, incluyendo patrones estacionales, mantenimientos programados e imprevistos (aproximadamente el 10%), variaciones en la eficiencia (baja, normal, alta) y anomalías (aproximadamente el 1%).

Las variables dentro de estos conjuntos de datos se clasifican como:

* **Cuantitativas:** ΔT Agua (°C) (diferencial de temperatura del agua), Temperatura de los Gases GCP (°C) (temperatura de los gases que salen del Proceso de Limpieza de Gases).
* **Cualitativas:** Planta (GCP-2, GCP-4), Equipo (EP-110 A-F), Estado (En Servicio, Mantención), Comentarios.

Descripción de los conjuntos de datos:

* `data_extrapolated.csv` (1,157,184 filas): Registros horarios de 12 enfriadores (EP-110 A-F) en GCP-2 y GCP-4. Columnas: Fecha, Hora, Planta, Equipo, Estado, Temp Entrada Agua Torre (Temperatura de Entrada de Agua de la Torre), Temp Salida Agua Torre (Temperatura de Salida de Agua de la Torre), Delta Agua (Diferencial de Temperatura del Agua), Temp Entrada Efluente (Temperatura de Entrada del Efluente), Temp Salida Efluente (Temperatura de Salida del Efluente), Delta Efluente (Diferencial de Temperatura del Efluente), Comentarios.
* `temp_gcp_data_extrapolated.csv` (16,072 filas): Registros diarios (12:00) de 4 trenes del Proceso de Limpieza de Gases (GCP) (GCP-2A, GCP-2B, GCP-4A, GCP-4B). Columnas: FechaHora, Tren, Temperatura, Comentarios.

##   2.1 Irregularidades de los datos:
* **Registros de Mantenimiento:** Los registros con `Estado` = "Mantención" tienen ΔT Agua = 0 y `Comentario` = "Ingreso histórico".
* **Anomalías:** Aproximadamente el 1% de los registros muestra desviaciones significativas en las temperaturas de entrada/salida del agua o en los diferenciales de temperatura, y están etiquetados como `Comentario` = "Anomalía".
* **Variaciones de Eficiencia:** Aproximadamente el 5% de los registros muestra un ΔT Agua bajo (1-2°C) y están etiquetados como `Comentario` = "Baja eficiencia", mientras que otro 5% muestra un ΔT Agua alto (6-8°C) y están etiquetados como `Comentario` = "Alta eficiencia".

```{r cargar-datos}
ep <- read_csv("data_extrapolated.csv", show_col_types = FALSE) %>%
  mutate(FechaHora = as.POSIXct(paste(Fecha, Hora), format="%Y-%m-%d %H:%M")) %>%
  filter(!is.na(FechaHora))

gcp <- read_csv("temp_gcp_data_extrapolated.csv") %>%
  mutate(FechaHora = ymd_hms(FechaHora))
```
> **Nota técnica:**  
> Para este análisis se utilizará como referencia principal el diferencial de temperatura del agua (ΔT Agua), ya que entrega una medición más estable y representativa del desempeño térmico de los enfriadores EP-110. En contraste, las temperaturas del lado efluente presentan alta variabilidad debido a las diferencias en el revestimiento interno de las líneas y a la heterogeneidad en los espesores, lo cual afecta su confiabilidad como indicador de eficiencia térmica.


# 3. Pre-procesamiento de Datos

El preprocesamiento de los datos se realizó en varias etapas para asegurar la calidad y relevancia del análisis. A continuación, se detallan los pasos seguidos:

- **Filtrado de registros de mantenimiento:** Se eliminaron los registros donde la variable Delta Agua es igual a 0, ya que estos valores corresponden a los períodos en que los enfriadores EP-110 estaban en mantenimiento y, por lo tanto, no reflejan su rendimiento térmico normal.
- **Renombrado de la variable:**Se renombró la columna Delta Agua a Δ Temp Agua para mejorar la claridad y consistencia en la nomenclatura a lo largo del análisis.
- **Manejo de valores faltantes:** Se eliminaron las filas que contenían valores faltantes (NA) en la variable Δ Temp Agua para evitar errores en los cálculos y visualizaciones posteriores. Adicionalmente, se eliminaron los 12 valores faltantes en la columna FechaHora.
- **Muestreo aleatorio para el EDA:** Dado el gran volumen de datos (1,157,184 filas en el dataset ep), se realizó un muestreo aleatorio del 10% del dataset ep y gcp para el Análisis Exploratorio de Datos (EDA) y las visualizaciones. Este muestreo se realizó para mejorar la eficiencia computacional y la claridad de las visualizaciones, preservando la representatividad de los datos. Se fijó la semilla aleatoria en 123 para garantizar la reproducibilidad del muestreo.

```{r limpieza}
ep <- ep %>%
  filter(`Delta Agua` > 0) %>%
  rename(`Δ Temp Agua` = `Delta Agua`) %>%
  filter(!is.na(`Δ Temp Agua`))

# Muestreo aleatorio (10%) para análisis
set.seed(123)
ep_sample <- ep %>% sample_frac(0.1)
gcp_sample <- gcp %>% sample_frac(0.1)

summary(ep_sample)
summary(gcp_sample)
```

# 4. Análisis Exploratorio de Datos (EDA)
## 4.1 Distribución de ΔT Agua por Equipo
```{r boxplots}
p <- ggplot(ep_sample, aes(x = Equipo, y = `Δ Temp Agua`, fill = Planta)) +
  geom_boxplot(notch = TRUE) +
  stat_summary(fun = mean, geom = "point", shape = 23, size = 3, color = "black") + # Añadir la media
  labs(
    title = "Distribución de ΔT Agua por Equipo y Planta (Muestreo 10%)",
    y = "ΔT Agua (°C)",
    x = "Equipo",
    fill = "Planta"
  ) +
  scale_fill_brewer(palette = "Dark2") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))

print(p)
```

**Interpretación:**

- Se observa que la mediana de ΔT Agua varía entre los equipos. El equipo EP-110 A muestra una mediana más baja en comparación con otros equipos, lo que sugiere un posible menor rendimiento térmico.
- La dispersión de los datos (rango intercuartílico) también difiere entre los equipos, lo que indica diferencias en la variabilidad del rendimiento térmico.
- Al comparar las plantas, se puede notar que GCP-2 (verde) tiende a tener una mediana ligeramente más baja en algunos equipos en comparación con GCP-4 (naranja).
- Los "notches" permiten inferir que hay diferencias significativas en las medianas entre algunos equipos, aunque se requiere un análisis estadístico más formal para confirmarlo.
- La presencia de valores atípicos (puntos fuera de los bigotes) indica la existencia de observaciones con rendimientos térmicos extremos, los cuales podrían ser objeto de investigación adicional.


## 4.2  Histograma de ΔT Agua

```{r histograma-dt-agua}
p <- ggplot(ep_sample %>% filter(`Δ Temp Agua` > 0 & `Δ Temp Agua` <= 10),
            aes(x = `Δ Temp Agua`, fill = Planta)) +
  geom_histogram(binwidth = 0.25, position = "dodge", alpha = 0.7) +
  labs(title = "Histograma de ΔT Agua por Planta (Lado a Lado, Muestreo 10%)",
       x = "ΔT Agua (°C)",
       y = "Frecuencia") +
  scale_fill_manual(values = c("#1B9E77", "#D95F02"), name = "Planta") +
  theme_minimal()
print(p)
```

**Interpretación:**

- La distribución de ΔT Agua muestra un pico principal alrededor de 4-5 °C, lo que indica que la mayoría de las observaciones se concentran en este rango.
Ambas plantas (GCP-2 y GCP-4) muestran distribuciones similares, aunque GCP-2 (verde) parece tener una frecuencia ligeramente mayor en los valores más bajos de ΔT Agua (alrededor de 3-4 °C).
- La distribución parece tener un ligero sesgo a la derecha, lo que sugiere que hay una cola más larga de observaciones con valores de ΔT Agua más altos.
- La forma de la distribución sugiere que el rendimiento térmico de los enfriadores EP-110 tiende a ser similar entre las plantas, con la mayoría de los equipos operando dentro de un rango óptimo, aunque con una pequeña proporción operando con menor rendimiento.


## 4.3 Correlación entre ΔT Agua y Temperatura Gas Salida GCP´s
```{r correlacion}
ep_daily <- ep_sample %>%
  mutate(Fecha = as.Date(FechaHora)) %>%
  group_by(Fecha, Planta, Equipo) %>%
  summarise(`Δ Temp Agua` = mean(`Δ Temp Agua`, na.rm = TRUE), .groups = "drop")

gcp_daily <- gcp_sample %>%
  mutate(Fecha = as.Date(FechaHora)) %>%
  group_by(Fecha, Tren) %>%
  summarise(Temperatura = mean(Temperatura, na.rm = TRUE), .groups = "drop")

merged_daily <- inner_join(ep_daily, gcp_daily, by = "Fecha")

cor_data_daily <- merged_daily %>%
  group_by(Equipo, Tren) %>%
  summarise(
    n = sum(!is.na(`Δ Temp Agua`) & !is.na(Temperatura)),
    sd_dt = sd(`Δ Temp Agua`, na.rm = TRUE),
    sd_temp = sd(Temperatura, na.rm = TRUE),
    correlacion = if (n >= 3 && sd_dt > 0 && sd_temp > 0) {
      cor(`Δ Temp Agua`, Temperatura, use = "complete.obs")
    } else {
      NA_real_
    },
    .groups = "drop"
  ) %>%
  arrange(correlacion)

print(cor_data_daily)

ggplot(merged_daily, aes(x = Temperatura, y = `Δ Temp Agua`, color = Equipo)) +
  geom_point(alpha = 0.5) +
  facet_wrap(~ Tren, scales = "free") +
  labs(
    title = "Correlación entre Temperatura de Gases y ΔT Agua (Datos Diarios)",
    x = "Temperatura Promedio Diaria Gas Salida (°C)",
    y = "Promedio Diario ΔT Agua (°C)",
    color = "Equipo"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

**Interpretación:**

- La tabla cor_data_daily muestra las correlaciones de Pearson entre ΔT Agua y Temperatura para cada combinación de Equipo y Tren. Las correlaciones varían entre -0.052 y -0.003, lo que indica una correlación negativa muy débil entre las dos variables. Esto sugiere que, en general, no hay una relación lineal fuerte entre la temperatura de los gases y el rendimiento térmico de los enfriadores.
- El gráfico de dispersión confirma la débil correlación. Los puntos están dispersos sin un patrón lineal claro, y la variabilidad en ΔT Agua no parece estar fuertemente influenciada por la temperatura de los gases.
- Es importante notar que esta falta de correlación lineal no descarta la posibilidad de relaciones no lineales o la influencia de otras variables.


## 4.4 Comparación Temperatura de Salida Gas Trenes y ΔT Agua EP-110

En esta sección, se compara la temperatura de salida de los gases de los trenes GCP-2A/B y GCP-4A/B con el diferencial de temperatura del agua (ΔT Agua) de los enfriadores EP-110 asociados. Esta comparación es crucial para evaluar la eficiencia del proceso de enfriamiento: una alta temperatura de salida del gas combinada con un bajo ΔT Agua puede indicar un mal funcionamiento del enfriador. Se utilizan gráficos con doble eje para visualizar ambas variables en la misma escala temporal, facilitando la identificación de patrones y relaciones. La función de rescalado (`rescale_dt` y `inv_rescale_dt`) permite mostrar el ΔT Agua en un rango similar al de la temperatura del gas, mejorando la legibilidad del gráfico.


```{r tren-gcp2a-vs-dt-improved, fig.width=12, fig.height=6}
# Función de rescalado para ΔT Agua
rescale_dt <- function(x) {
  scales::rescale(x, to = c(10, 45), from = c(0, 10))
}

inv_rescale_dt <- function(x) {
  scales::rescale(x, from = c(10, 45), to = c(0, 10))
}

# Agregar datos a nivel diario para evitar relación muchos a muchos
ep2a_daily <- ep_sample %>%
  filter(Equipo %in% c("EP-110 A", "EP-110 B", "EP-110 C"), `Δ Temp Agua` > 0) %>%
  mutate(Date = as.Date(FechaHora)) %>%
  group_by(Date, Equipo) %>%
  summarise(`Δ Temp Agua` = mean(`Δ Temp Agua`, na.rm = TRUE), .groups = "drop")

gcp2a_daily <- gcp_sample %>%
  filter(Tren == "GCP-2A") %>%
  mutate(Date = as.Date(FechaHora)) %>%
  group_by(Date) %>%
  summarise(Temperatura = mean(Temperatura, na.rm = TRUE), .groups = "drop")

# Unir datos diarios
merged_daily <- inner_join(ep2a_daily, gcp2a_daily, by = "Date")

# Gráfico con hexbin para densidad
ggplot() +
  geom_hex(data = merged_daily, aes(x = Date, y = rescale_dt(`Δ Temp Agua`), color = Equipo), bins = 50, alpha = 0.7) +
  scale_fill_gradient(low = "lightblue", high = "darkblue", name = "Densidad") +
  geom_line(data = gcp2a_daily, aes(x = Date, y = Temperatura), color = "red", linewidth = 1) +
  geom_hline(yintercept = 32, color = "darkred", linetype = "dashed", linewidth = 0.8) +
  annotate("text", x = as.Date("2016-01-01"), y = 33.2, label = "Diseño 32°C", color = "darkred", size = 3.5, hjust = 0) +
  scale_y_continuous(
    name = "Temperatura Gas Salida GCP-2A (°C)",
    limits = c(10, 45),
    sec.axis = sec_axis(~ inv_rescale_dt(.), name = "ΔT Agua (°C)", breaks = seq(0, 10, 2))
  ) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  scale_color_brewer(palette = "Dark2", name = "Equipo") +
  labs(
    title = "Temperatura Gas Salida GCP-2A vs ΔT Agua (EP-110 A/B/C) - Datos Diarios",
    x = "Fecha", y = "Temperatura Gas Salida GCP-2A (°C)"
  ) +
  theme_minimal() +
  theme(
    axis.title.y.left = element_text(color = "red", face = "bold"),
    axis.text.y.left = element_text(color = "red"),
    axis.title.y.right = element_text(color = "blue", face = "bold"),
    axis.text.y.right = element_text(color = "blue"),
    legend.position = "bottom",
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold")
  )
```
**Interpretación:**

- La temperatura de salida del gas GCP-2A (línea roja) muestra una tendencia general a aumentar a lo largo del tiempo, con fluctuaciones estacionales.
- El diseño de la temperatura de salida es de 32°C, el cual se excede frecuentemente a lo largo del tiempo.
- Los valores de ΔT Agua (puntos coloreados) varían significativamente entre los equipos EP-110 A, B y C. El equipo EP-110 A (marrón) tiende a mostrar valores más bajos de ΔT Agua en comparación con los otros equipos, lo que podría indicar un menor rendimiento térmico.
- En general, no se observa una correlación clara y directa entre la temperatura del gas y el ΔT Agua. Sin embargo, en algunos momentos, se puede ver que picos en la temperatura del gas coinciden con caídas en el ΔT Agua de algunos equipos, lo que sugiere que las altas temperaturas del gas podrían estar afectando negativamente el rendimiento de los enfriadores.


```{r tren-gcp2b-vs-dt-improved, fig.width=12, fig.height=6}
# Función de rescalado para ΔT Agua
rescale_dt <- function(x) {
  scales::rescale(x, to = c(10, 45), from = c(0, 10))
}

inv_rescale_dt <- function(x) {
  scales::rescale(x, from = c(10, 45), to = c(0, 10))
}

# Agregar datos a nivel diario
ep2b_daily <- ep_sample %>%
  filter(Equipo %in% c("EP-110 D", "EP-110 E", "EP-110 F"), `Δ Temp Agua` > 0) %>%
  mutate(Date = as.Date(FechaHora)) %>%
  group_by(Date, Equipo) %>%
  summarise(`Δ Temp Agua` = mean(`Δ Temp Agua`, na.rm = TRUE), .groups = "drop")

gcp2b_daily <- gcp_sample %>%
  filter(Tren == "GCP-2B") %>%
  mutate(Date = as.Date(FechaHora)) %>%
  group_by(Date) %>%
  summarise(Temperatura = mean(Temperatura, na.rm = TRUE), .groups = "drop")

# Unir datos diarios
merged_daily_2b <- inner_join(ep2b_daily, gcp2b_daily, by = "Date")

# Gráfico con hexbin para densidad
ggplot() +
  geom_hex(data = merged_daily_2b, aes(x = Date, y = rescale_dt(`Δ Temp Agua`), color = Equipo), bins = 50, alpha = 0.7) +
  scale_fill_gradient(low = "lightblue", high = "darkblue", name = "Densidad") +
  geom_line(data = gcp2b_daily, aes(x = Date, y = Temperatura), color = "red", linewidth = 1) +
  geom_hline(yintercept = 32, color = "darkred", linetype = "dashed", linewidth = 0.8) +
  annotate("text", x = as.Date("2016-01-01"), y = 33.2, label = "Diseño 32°C", color = "darkred", size = 3.5, hjust = 0) +
  scale_y_continuous(
    name = "Temperatura Gas Salida GCP-2B (°C)",
    limits = c(10, 45),
    sec.axis = sec_axis(~ inv_rescale_dt(.), name = "ΔT Agua (°C)", breaks = seq(0, 10, 2))
  ) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  scale_color_brewer(palette = "Dark2", name = "Equipo") +
  labs(
    title = "Temperatura Gas Salida GCP-2B vs ΔT Agua (EP-110 D/E/F) - Datos Diarios",
    x = "Fecha", y = "Temperatura Gas Salida GCP-2B (°C)"
  ) +
  theme_minimal() +
  theme(
    axis.title.y.left = element_text(color = "red", face = "bold"),
    axis.text.y.left = element_text(color = "red"),
    axis.title.y.right = element_text(color = "blue", face = "bold"),
    axis.text.y.right = element_text(color = "blue"),
    legend.position = "bottom",
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold")
  )
```
**Interpretación:**

- Al igual que con GCP-2A, la temperatura de salida del gas para GCP-2B (línea roja) muestra una tendencia general a aumentar a lo largo del tiempo, con fluctuaciones.
- La temperatura de diseño de 32°C también se excede con frecuencia para GCP-2B.
Los valores de ΔT Agua muestran variabilidad entre los equipos EP-110 D, E y F. En este caso, el equipo EP-110 F (morado) parece mostrar valores más bajos de ΔT Agua en algunos períodos, lo que podría indicar un rendimiento térmico inferior en comparación con los otros equipos.
- No se observa una correlación clara y consistente entre la temperatura del gas y el ΔT Agua para estos equipos. Sin embargo, al igual que con GCP-2A, se pueden identificar algunos momentos en que los picos de temperatura del gas coinciden con caídas en el ΔT Agua, lo que sugiere una posible influencia negativa de la alta temperatura en el rendimiento.

```{r tren-gcp4a-vs-dt-improved, fig.width=12, fig.height=6}
# Función de rescalado para ΔT Agua
rescale_dt <- function(x) {
  scales::rescale(x, to = c(10, 45), from = c(0, 10))
}

inv_rescale_dt <- function(x) {
  scales::rescale(x, from = c(10, 45), to = c(0, 10))
}

# Agregar datos a nivel diario
ep4a_daily <- ep_sample %>%
  filter(Equipo %in% c("EP-110 A", "EP-110 B", "EP-110 C"), `Δ Temp Agua` > 0) %>%
  mutate(Date = as.Date(FechaHora)) %>%
  group_by(Date, Equipo) %>%
  summarise(`Δ Temp Agua` = mean(`Δ Temp Agua`, na.rm = TRUE), .groups = "drop")

gcp4a_daily <- gcp_sample %>%
  filter(Tren == "GCP-4A") %>%
  mutate(Date = as.Date(FechaHora)) %>%
  group_by(Date) %>%
  summarise(Temperatura = mean(Temperatura, na.rm = TRUE), .groups = "drop")

# Unir datos diarios
merged_daily_4a <- inner_join(ep4a_daily, gcp4a_daily, by = "Date")

# Gráfico con hexbin para densidad
ggplot() +
  geom_hex(data = merged_daily_4a, aes(x = Date, y = rescale_dt(`Δ Temp Agua`), color = Equipo), bins = 50, alpha = 0.7) +
  scale_fill_gradient(low = "lightblue", high = "darkblue", name = "Densidad") +
  geom_line(data = gcp4a_daily, aes(x = Date, y = Temperatura), color = "red", linewidth = 1) +
  geom_hline(yintercept = 32, color = "darkred", linetype = "dashed", linewidth = 0.8) +
  annotate("text", x = as.Date("2016-01-01"), y = 33.2, label = "Diseño 32°C", color = "darkred", size = 3.5, hjust = 0) +
  scale_y_continuous(
    name = "Temperatura Gas Salida GCP-4A (°C)",
    limits = c(10, 45),
    sec.axis = sec_axis(~ inv_rescale_dt(.), name = "ΔT Agua (°C)", breaks = seq(0, 10, 2))
  ) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  scale_color_brewer(palette = "Dark2", name = "Equipo") +
  labs(
    title = "Temperatura Gas Salida GCP-4A vs ΔT Agua (EP-110 A/B/C) - Datos Diarios",
    x = "Fecha", y = "Temperatura Gas Salida GCP-4A (°C)"
  ) +
  theme_minimal() +
  theme(
    axis.title.y.left = element_text(color = "red", face = "bold"),
    axis.text.y.left = element_text(color = "red"),
    axis.title.y.right = element_text(color = "blue", face = "bold"),
    axis.text.y.right = element_text(color = "blue"),
    legend.position = "bottom",
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold")
  )
```
**Interpretación:**

- La temperatura de salida del gas para GCP-4A (línea roja) también muestra una tendencia a aumentar a lo largo del tiempo, con fluctuaciones similares a las observadas en GCP-2A y GCP-2B.
- La temperatura de diseño de 32°C se excede con frecuencia, lo que sugiere que este es un patrón común en todas las plantas.
- Los valores de ΔT Agua para los equipos EP-110 A, B y C muestran variabilidad. En este caso, no hay un equipo que se destaque claramente por tener un rendimiento consistentemente más bajo.
- Al igual que con los trenes anteriores, no se observa una correlación fuerte entre la temperatura del gas y el ΔT Agua. Sin embargo, se pueden identificar algunos momentos en que los picos de temperatura coinciden con ligeras disminuciones en el ΔT Agua, lo que sugiere una posible influencia de la temperatura en el rendimiento, aunque la relación no es directa ni consistente.

```{r tren-gcp4b-vs-dt-improved, fig.width=12, fig.height=6}
# Función de rescalado para ΔT Agua
rescale_dt <- function(x) {
  scales::rescale(x, to = c(10, 45), from = c(0, 10))
}

inv_rescale_dt <- function(x) {
  scales::rescale(x, from = c(10, 45), to = c(0, 10))
}

# Agregar datos a nivel diario
ep4b_daily <- ep_sample %>%
  filter(Equipo %in% c("EP-110 D", "EP-110 E", "EP-110 F"), `Δ Temp Agua` > 0) %>%
  mutate(Date = as.Date(FechaHora)) %>%
  group_by(Date, Equipo) %>%
  summarise(`Δ Temp Agua` = mean(`Δ Temp Agua`, na.rm = TRUE), .groups = "drop")

gcp4b_daily <- gcp_sample %>%
  filter(Tren == "GCP-4B") %>%
  mutate(Date = as.Date(FechaHora)) %>%
  group_by(Date) %>%
  summarise(Temperatura = mean(Temperatura, na.rm = TRUE), .groups = "drop")

# Unir datos diarios
merged_daily_4b <- inner_join(ep4b_daily, gcp4b_daily, by = "Date")

# Gráfico con hexbin para densidad
ggplot() +
  geom_hex(data = merged_daily_4b, aes(x = Date, y = rescale_dt(`Δ Temp Agua`), color = Equipo), bins = 50, alpha = 0.7) +
  scale_fill_gradient(low = "lightblue", high = "darkblue", name = "Densidad") +
  geom_line(data = gcp4b_daily, aes(x = Date, y = Temperatura), color = "red", linewidth = 1) +
  geom_hline(yintercept = 32, color = "darkred", linetype = "dashed", linewidth = 0.8) +
  annotate("text", x = as.Date("2016-01-01"), y = 33.2, label = "Diseño 32°C", color = "darkred", size = 3.5, hjust = 0) +
  scale_y_continuous(
    name = "Temperatura Gas Salida GCP-4B (°C)",
    limits = c(10, 45),
    sec.axis = sec_axis(~ inv_rescale_dt(.), name = "ΔT Agua (°C)", breaks = seq(0, 10, 2))
  ) +
  scale_x_date(date_breaks = "1 year", date_labels = "%Y") +
  scale_color_brewer(palette = "Dark2", name = "Equipo") +
  labs(
    title = "Temperatura Gas Salida GCP-4B vs ΔT Agua (EP-110 D/E/F) - Datos Diarios",
    x = "Fecha", y = "Temperatura Gas Salida GCP-4B (°C)"
  ) +
  theme_minimal() +
  theme(
    axis.title.y.left = element_text(color = "red", face = "bold"),
    axis.text.y.left = element_text(color = "red"),
    axis.title.y.right = element_text(color = "blue", face = "bold"),
    axis.text.y.right = element_text(color = "blue"),
    legend.position = "bottom",
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold")
  )
```
**Interpretación:**

- La temperatura de salida del gas para GCP-4B (línea roja) sigue la tendencia observada en los trenes anteriores, con un aumento general a lo largo del tiempo y fluctuaciones.
- La temperatura de diseño de 32°C se excede con frecuencia, lo que refuerza la observación de que este es un patrón común en todas las plantas.
- Los valores de ΔT Agua para los equipos EP-110 D, E y F muestran variabilidad. En este caso, no se observa un equipo con un rendimiento consistentemente más bajo.
- Al igual que con los trenes anteriores, no se observa una correlación fuerte entre la temperatura del gas y el ΔT Agua. Sin embargo, se pueden identificar algunos momentos en que los picos de temperatura coinciden con ligeras disminuciones en el ΔT Agua, lo que sugiere una posible influencia de la temperatura en el rendimiento, aunque la relación no es directa ni consistente.


# 5. Planificación del Proyecto

**Marco Teórico:**

El análisis se centra en la eficiencia térmica de los enfriadores EP-110, medida a través del diferencial de temperatura del agua (ΔT Agua). Un ΔT Agua bajo (< 4°C) sugiere una menor capacidad de transferencia de calor, lo que puede ser indicativo de incrustaciones en las tuberías, desgaste de los componentes o fallos operativos. La acumulación de incrustaciones reduce la superficie de contacto entre el agua y el material de la tubería, disminuyendo la eficiencia de la transferencia de calor. El desgaste de los componentes, como bombas o intercambiadores de calor, también puede disminuir la capacidad del sistema para transferir calor eficazmente.

La temperatura de los gases de salida (GCP) influye en el desempeño de los enfriadores, ya que una temperatura alta implica una mayor carga térmica que el sistema debe disipar. En consecuencia, temperaturas elevadas de los gases pueden reducir el ΔT Agua si la capacidad de enfriamiento del sistema no es suficiente.

Los mantenimientos programados y no programados son cruciales para mantener la disponibilidad y eficiencia de los enfriadores. Los mantenimientos programados permiten realizar inspecciones y reemplazos preventivos, mientras que los mantenimientos no programados son necesarios para corregir fallos inesperados. La frecuencia y eficacia de ambos tipos de mantenimiento tienen un impacto directo en el rendimiento térmico de los enfriadores a lo largo del tiempo.

**Metodología:**

**1. Preprocesamiento:**

- Filtrar los registros de mantenimiento (ΔT Agua = 0) para excluir los períodos en que los enfriadores no están operando normalmente.
- Manejar los valores faltantes (NA) para evitar errores en los análisis posteriores.
- Realizar un muestreo aleatorio del 10% de los datos para acelerar el Análisis Exploratorio de Datos (EDA).

**2. Análisis Exploratorio de Datos (EDA):**

- Visualizar la distribución de ΔT Agua mediante histogramas y boxplots para identificar la variabilidad y los valores atípicos.
- Identificar los equipos críticos, definiéndolos como aquellos con un ΔT Agua promedio inferior a 4°C o con más del 20% de los registros por debajo de este umbral. Este umbral se basa en la experiencia y el conocimiento del dominio, y representa un límite inferior para el rendimiento aceptable.
- Analizar las correlaciones entre ΔT Agua y la Temperatura GCP mediante gráficos de dispersión y el cálculo del coeficiente de correlación de Pearson.

**3. Análisis de mantenimiento:**

- Identificar los ciclos completos de mantenimiento, definiéndolos como períodos en los que se interviene simultáneamente en 6 o más equipos.
- Evaluar el impacto de los ciclos de mantenimiento en el ΔT Agua a lo largo del tiempo.

**4. Modelado:**

- Ajustar un modelo de regresión lineal para predecir ΔT Agua en función de la Temperatura GCP, el Estado del equipo y el Equipo. La regresión lineal se elige por su simplicidad y capacidad para modelar relaciones lineales entre variables.

**5. Validación:**

- Validar el modelo de regresión utilizando un subconjunto de datos de prueba para evaluar su capacidad de generalización.

**Entregables:**

- Gráficos de distribución (boxplots, histogramas) y series temporales en formato PNG.
- Tabla de equipos críticos en formato CSV, indicando el promedio de ΔT Agua y el porcentaje de registros bajo el umbral de 4°C.
- Línea de tiempo de los ciclos de mantenimiento en formato PNG, mostrando la frecuencia y duración de los mantenimientos a lo largo del tiempo.
- Modelo predictivo de ΔT Agua en formato R (archivo .R), junto con la interpretación de los coeficientes y las métricas de evaluación del modelo.
- Función modular `analisis_ep110()` para el análisis automatizado del rendimiento de los enfriadores, implementada en un script de R (archivo .R).


# 6. Interpretación de Resultados

En esta sección, se interpretan los resultados del análisis exploratorio de datos y del análisis de ciclos de mantenimiento, relacionándolos con las preguntas de investigación y el marco teórico.

## 6.1 Equipos Críticos
Para identificar los equipos críticos, se calcularon el promedio de ΔT Agua (`promedio_dt`), el número de registros por debajo del umbral de 4°C (`bajo_umbral`) y el porcentaje de registros por debajo de este umbral (`pct_bajo`) para cada equipo en las plantas GCP-2 y GCP-4. Los resultados se muestran en las siguientes tablas:

### 6.1.1 Equipos Críticos en GCP-2
```{r resumen-gcp2}
resumen_gcp2 <- ep %>%
  filter(Planta == "GCP-2", `Δ Temp Agua` > 0) %>%
  group_by(Equipo) %>%
  summarise(
    promedio_dt = mean(`Δ Temp Agua`, na.rm = TRUE),
    bajo_umbral = sum(`Δ Temp Agua` < 4),
    pct_bajo = 100 * mean(`Δ Temp Agua` < 4),
    .groups = "drop"
  ) %>%
  arrange(promedio_dt)

resumen_gcp2
```
**Interpretación:**

- La tabla muestra que en la planta GCP-2, los equipos EP-110 A, C y E presentan un ΔT Agua promedio inferior a 4°C (3.67, 3.82 y 3.75 °C, respectivamente) y un alto porcentaje de registros por debajo de este umbral (todos por encima del 75%). Esto indica que estos equipos operan con un rendimiento térmico significativamente reducido, lo que sugiere una posible pérdida de capacidad de transferencia de calor debido a incrustaciones, desgaste o fallos operativos. El equipo EP-110 B también muestra un porcentaje alto de registros bajo el umbral (68.1%), aunque su promedio es ligeramente superior a 4°C.

### 6.1.2 Equipos Críticos en GCP-4
```{r resumen-gcp4}
resumen_gcp4 <- ep %>%
  filter(Planta == "GCP-4", `Δ Temp Agua` > 0) %>%
  group_by(Equipo) %>%
  summarise(
    promedio_dt = mean(`Δ Temp Agua`, na.rm = TRUE),
    bajo_umbral = sum(`Δ Temp Agua` < 4),
    pct_bajo = 100 * mean(`Δ Temp Agua` < 4),
    .groups = "drop"
  ) %>%
  arrange(promedio_dt)

resumen_gcp4
```
**Interpretación:**

- En la planta GCP-4, los equipos EP-110 C, A y F también presentan un ΔT Agua promedio inferior a 4°C y un alto porcentaje de registros por debajo del umbral. Esto confirma la presencia de equipos críticos en ambas plantas, lo que refuerza la necesidad de una inspección y mantenimiento exhaustivos.

## 6.2 Ciclos de Matenimiento
Para analizar los ciclos de mantenimiento, se identificaron los períodos en los que se intervino simultáneamente en 6 o más equipos. Los resultados se muestran en las siguientes tablas:

```{r ciclos}
ciclos <- ep %>%
  filter(Estado == "Mantención") %>%
  group_by(Planta, Fecha) %>%
  summarise(equipos_intervenidos = n_distinct(Equipo), .groups = "drop") %>%
  filter(equipos_intervenidos >= 6) # Cambiado a >= 6 para capturar ciclos completos

ciclos

ciclos_por_año <- ciclos %>%
  mutate(Año = year(Fecha)) %>%
  group_by(Planta, Año) %>%
  summarise(ciclos = n(), .groups = "drop")

ciclos_por_año
```
**Interpretación:**

- Se identificaron un total de 11 ciclos de mantenimiento en ambas plantas. Sin embargo, la frecuencia de estos ciclos por año es baja, con años que presentan solo 1 o 2 ciclos. Esto es inconsistente con la planificación de 2 mantenimientos programados por equipo por año, lo que sugiere una falta de coordinación en la ejecución de los mantenimientos integrales.


# 7. Conclusiones

Este análisis térmico de los enfriadores EP-110 en las plantas GCP-2 y GCP-4 ha permitido responder a las preguntas de investigación planteadas y obtener información valiosa para la optimización del control térmico y la gestión del mantenimiento. A continuación, se presentan las principales conclusiones:

## 7.1 Presencia de equipos críticos:
En la planta GCP-2, los equipos EP-110 A, C y E presentan un ΔT Agua promedio inferior a 4°C y más del 75% de los registros por debajo de este umbral. Esto indica una significativa pérdida de eficiencia en estos equipos, lo que podría resultar en una menor capacidad de enfriamiento, un mayor consumo de energía y un riesgo de daños a los equipos. Se recomienda realizar una inspección detallada de estos equipos para identificar las causas del bajo rendimiento (por ejemplo, incrustaciones, desgaste de componentes) y programar un mantenimiento correctivo a la brevedad.

En la planta GCP-4, los equipos EP-110 C, A y F muestran un comportamiento similar, con un ΔT Agua promedio bajo y un alto porcentaje de registros por debajo del umbral. Esto confirma la presencia de equipos críticos en ambas plantas y subraya la necesidad de una estrategia de mantenimiento integral.

## 7.2 Tendencia general en GCP-2 vs. GCP-4:
Se observa una tendencia general a una mayor criticidad en los equipos de la planta GCP-2 en comparación con la planta GCP-4. Mientras que todos los equipos de GCP-2 muestran algún nivel de criticidad, GCP-4 presenta una distribución más equilibrada, con tres equipos operando dentro de rangos aceptables. Esta diferencia podría deberse a variaciones en las condiciones operativas, la antigüedad de los equipos o las prácticas de mantenimiento entre las plantas. Se recomienda investigar las causas de esta disparidad para optimizar las estrategias de mantenimiento y asignar los recursos de manera eficiente.

## 7.3 Ciclos completos de mantención:
Se identificaron ciclos de mantenimiento con la intervención simultánea de 6 o más equipos, pero su frecuencia anual es baja (por ejemplo, 0-2 ciclos) y no coincide con los 2 mantenimientos programados por equipo por año. Esta falta de coordinación en los mantenimientos integrales podría resultar en una menor eficiencia del mantenimiento, un mayor tiempo de inactividad de los equipos y un mayor riesgo de fallos inesperados. Se recomienda implementar un programa de mantenimiento coordinado que asegure el cumplimiento de los mantenimientos programados y optimice la planificación de los ciclos integrales.

## 7.4 Correlación:
La correlación negativa débil observada entre ΔT Agua y la Temperatura GCP (alrededor de -0.17) sugiere que, si bien no hay una relación lineal fuerte, las altas temperaturas de los gases podrían estar contribuyendo a una reducción en la eficiencia térmica de los enfriadores. Este hallazgo respalda el marco teórico, que plantea que una mayor carga térmica puede dificultar la capacidad de los enfriadores para disipar el calor de manera efectiva. Sin embargo, la debilidad de la correlación indica que otros factores también están influyendo en el rendimiento de los enfriadores.

# 8. Propuesta de Función Modular para el Examen:

Se propone la implementación de un dashboard interactivo desarrollado con Shiny que integre la función `analisis_ep110()` para el monitoreo periódico del rendimiento de los enfriadores EP-110 y la gestión del mantenimiento. Este dashboard permitiría a los usuarios explorar los datos de forma dinámica y tomar decisiones informadas basadas en el análisis.

## 8.1 Descripción de la función `analisis_ep110()`:
La función `analisis_ep110()` tiene como objetivo automatizar el análisis del desempeño térmico de los enfriadores EP-110.

**Inputs:**

- `ep_data` (dataframe): Un dataframe con los datos de los enfriadores EP-110 (similar a `data_extrapolated.csv`), que incluye columnas como `FechaHora`, `Planta`, `Equipo`, `Δ Temp Agua`, `Estado`.
- `gcp_data` (dataframe, opcional): Un dataframe con los datos de temperatura de los gases (similar a `temp_gcp_data_extrapolated.csv`), que incluye columnas como `FechaHora`, `Tren`, `Temperatura`. Este input es opcional, ya que algunas funcionalidades pueden no requerirlo.
- `fecha_inicio` (date, opcional): Fecha de inicio del análisis.
- `fecha_fin` (date, opcional): Fecha de fin del análisis.

**Outputs:**

- `equipos_criticos` (dataframe): Un dataframe que identifica los equipos críticos, con columnas como `Equipo`, `promedio_dt`, `pct_bajo`.
- `ciclos_mantenimiento` (dataframe): Un dataframe con información sobre los ciclos de mantenimiento, con columnas como `Planta`, `Fecha`, `equipos_intervenidos`.
- `correlacion_dt_temp` (dataframe, opcional): Un dataframe con las correlaciones entre `Δ Temp Agua` y `Temperatura` (si se proporciona `gcp_data`).
- `graficos` (lista): Una lista que contiene los gráficos generados por la función (por ejemplo, gráficos de series temporales de `Δ Temp Agua`, histogramas, boxplots).

**Funcionalidad:**

1. Realiza el preprocesamiento de los datos (filtrado, manejo de NAs).
2. Calcula las métricas de rendimiento (promedio de `Δ Temp Agua`, porcentaje de registros bajo el umbral).
3. Identifica los equipos críticos.
4. Identifica los ciclos de mantenimiento.
5. Calcula la correlación entre `Δ Temp Agua` y `Temperatura` (si se proporciona `gcp_data`).
6. Genera visualizaciones relevantes (gráficos de series temporales, histogramas, boxplots, gráficos de dispersión).

## 8.2 Descripción del dashboard de Shiny:
El dashboard de Shiny proporcionará una interfaz interactiva para explorar los resultados del análisis realizado por la función `analisis_ep110()`.

**Elementos de la interfaz:**

- Selectores para filtrar los datos por `Planta` y rango de `Fechas`.
- Paneles para mostrar los dataframes `equipos_criticos`, `ciclos_mantenimiento` y `correlacion_dt_temp` (usando `DT::datatable` para la interactividad).
- Paneles para mostrar los gráficos generados por la función (usando `plotly` para la interactividad).
- Un panel para programar los ciclos de mantenimiento (permitiendo al usuario seleccionar los equipos y las fechas).

**Interactividad:**

- Los usuarios pueden filtrar los datos por `Planta` y rango de `Fechas` para explorar subconjuntos específicos de los datos.
- Las tablas y los gráficos se actualizan dinámicamente en respuesta a los filtros seleccionados por el usuario.
- Los usuarios pueden hacer clic en los gráficos para ver detalles específicos.
- Los usuarios pueden seleccionar equipos y fechas para programar los ciclos de mantenimiento.

**Beneficios:**

- Facilita el monitoreo continuo del rendimiento de los enfriadores.
- Permite identificar rápidamente los equipos críticos que requieren atención.
- Mejora la planificación y coordinación de los ciclos de mantenimiento.
- Proporciona una plataforma para la toma de decisiones informadas basadas en datos.

## 8.3 Conexión con el análisis:
La función `analisis_ep110()` encapsula la lógica del análisis realizado en las secciones anteriores del informe, lo que permite automatizar el proceso y aplicarlo a nuevos datos. El dashboard de Shiny proporciona una interfaz amigable para que los usuarios interactúen con los resultados de este análisis, facilitando su comprensión y aplicación. Por ejemplo, los usuarios pueden utilizar el dashboard para:

- Filtrar los datos por un rango de fechas específico para evaluar el impacto de un mantenimiento reciente.
- Comparar el rendimiento de los equipos entre diferentes plantas.
- Identificar los equipos que han estado consistentemente por debajo del umbral de rendimiento aceptable.
- Planificar los ciclos de mantenimiento de manera óptima, considerando el rendimiento de los equipos y las fechas disponibles.



